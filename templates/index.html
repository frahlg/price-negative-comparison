<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOURCEFUL ENERGY TERMINAL v1.0</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/terminal.css') }}">
</head>
<body>
    <div class="terminal-container">
        <!-- Terminal Header -->
        <div class="terminal-system-info">
            SOURCEFUL ENERGY ANALYSIS SYSTEM v1.0<br>
            COPYRIGHT (C) 2025 - ENERGI OPTIMERING AB<br>
            READY.
        </div>

        <!-- ASCII Art Logo -->
        <div class="terminal-logo terminal-flicker">
███████╗ ██████╗ ██╗   ██╗██████╗  ██████╗███████╗███████╗██╗   ██╗██╗     
██╔════╝██╔═══██╗██║   ██║██╔══██╗██╔════╝██╔════╝██╔════╝██║   ██║██║     
███████╗██║   ██║██║   ██║██████╔╝██║     █████╗  █████╗  ██║   ██║██║     
╚════██║██║   ██║██║   ██║██╔══██╗██║     ██╔══╝  ██╔══╝  ██║   ██║██║     
███████║╚██████╔╝╚██████╔╝██║  ██║╚██████╗███████╗██║     ╚██████╔╝███████╗
╚══════╝ ╚═════╝  ╚═════╝ ╚═╝  ╚═╝ ╚═════╝╚══════╝╚═╝      ╚═════╝ ╚══════╝
                           ENERGY TERMINAL
        </div>

        <div class="terminal-divider"></div>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="terminal-{{ 'error' if category == 'error' else 'success' if category == 'success' else 'info' }}">
                        {{ category.upper() }}: {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Main Terminal Interface -->
        <div class="terminal-prompt terminal-text">
            SYSTEM REDO FÖR ANALYS AV ELPRODUKTION OCH PRISER
        </div>

        <div class="terminal-command-line terminal-text">
            LADDA UPP DIN PRODUKTIONSFIL FÖR ANALYS...
        </div>

        <!-- Upload Form -->
        <form id="uploadForm" action="/upload" method="POST" enctype="multipart/form-data" class="terminal-form">
            
            <!-- File Upload -->
            <label class="terminal-label">PRODUKTIONSFIL (CSV):</label>
            <div class="terminal-file-area" id="uploadArea">
                <input type="file" id="file" name="file" accept=".csv" required style="display: none;">
                <div class="upload-content">
                    DRA OCH SLÄPP DIN CSV-FIL HÄR<br>
                    ELLER <span style="color: #ffaa00; cursor: pointer;" onclick="document.getElementById('file').click()">KLICKA FÖR ATT VÄLJA FIL</span><br>
                    <small style="color: #666666;">MAX FILSTORLEK: 16MB</small>
                </div>
                <div class="file-info" style="display: none;">
                    FIL LADDAD: <span id="fileName" style="color: #ffaa00;"></span><br>
                    STORLEK: <span id="fileSize" style="color: #666666;"></span>
                </div>
            </div>

            <!-- Area Selection -->
            <label class="terminal-label">ELOMRÅDE:</label>
            <select class="terminal-select" id="area" name="area" required>
                <option value="">VÄLJ ELOMRÅDE...</option>
                <optgroup label="SVERIGE">
                    <option value="SE_1">SE_1 - NORRA SVERIGE</option>
                    <option value="SE_2">SE_2 - MELLERSTA SVERIGE</option>
                    <option value="SE_3">SE_3 - SÖDRA SVERIGE</option>
                    <option value="SE_4" selected>SE_4 - SYDSVERIGE</option>
                </optgroup>
                <optgroup label="NORGE">
                    <option value="NO_1">NO_1 - ÖSTRA NORGE</option>
                    <option value="NO_2">NO_2 - SÖDRA NORGE</option>
                    <option value="NO_3">NO_3 - MELLERSTA NORGE</option>
                    <option value="NO_4">NO_4 - NORRA NORGE</option>
                    <option value="NO_5">NO_5 - VÄSTRA NORGE</option>
                </optgroup>
                <optgroup label="DANMARK">
                    <option value="DK_1">DK_1 - VÄSTRA DANMARK</option>
                    <option value="DK_2">DK_2 - ÖSTRA DANMARK</option>
                </optgroup>
                <optgroup label="FINLAND">
                    <option value="FI">FI - FINLAND</option>
                </optgroup>
            </select>

            <!-- Currency Selection -->
            <label class="terminal-label">VALUTA:</label>
            <select class="terminal-select" id="currency" name="currency">
                <option value="SEK" selected>SEK - SVENSKA KRONOR</option>
                <option value="EUR">EUR - EURO</option>
                <option value="USD">USD - US DOLLAR</option>
                <option value="NOK">NOK - NORSKA KRONOR</option>
                <option value="DKK">DKK - DANSKA KRONOR</option>
                <option value="GBP">GBP - BRITTISKA PUND</option>
            </select>

            <!-- Date Range -->
            <label class="terminal-label">STARTDATUM (VALFRITT):</label>
            <input type="date" class="terminal-input" id="start_date" name="start_date" placeholder="YYYY-MM-DD">

            <label class="terminal-label">SLUTDATUM (VALFRITT):</label>
            <input type="date" class="terminal-input" id="end_date" name="end_date" placeholder="YYYY-MM-DD">

            <!-- Submit Button -->
            <button type="submit" class="terminal-button" id="submitBtn">
                ANALYSERA [ENTER]
            </button>

            <!-- Progress Bar -->
            <div class="terminal-progress" id="uploadProgress" style="display: none;">
                <div class="terminal-text">LADDAR UPP OCH ANALYSERAR<span class="terminal-loading"></span></div>
                <div class="terminal-progress-bar">
                    <div class="terminal-progress-fill" id="progressFill"></div>
                </div>
            </div>
        </form>

        <!-- Terminal Footer -->
        <div class="terminal-divider"></div>
        
        <div class="terminal-command-line terminal-text" style="text-align: center; color: #666666;">
            SOURCEFUL ENERGY ZAP - DIN ENERGIOPTIMERING BÖRJAR HÄR
        </div>

        <div class="terminal-text" style="text-align: center; margin-top: 20px;">
            <span class="cursor"></span>
        </div>
    </div>

    <!-- Terminal JavaScript -->
    <script>
        // File upload handling
        const fileInput = document.getElementById('file');
        const uploadArea = document.getElementById('uploadArea');
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        const uploadContent = uploadArea.querySelector('.upload-content');
        const fileInfo = uploadArea.querySelector('.file-info');
        const form = document.getElementById('uploadForm');
        const submitBtn = document.getElementById('submitBtn');
        const progressArea = document.getElementById('uploadProgress');
        const progressFill = document.getElementById('progressFill');

        // Drag and drop functionality
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('drag-over');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('drag-over');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('drag-over');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                if (file.name.toLowerCase().endsWith('.csv')) {
                    fileInput.files = files;
                    handleFileSelect(file);
                } else {
                    alert('FEL: ENDAST CSV-FILER TILLÅTNA');
                }
            }
        });

        // File input change
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileSelect(e.target.files[0]);
            }
        });

        function handleFileSelect(file) {
            fileName.textContent = file.name;
            fileSize.textContent = formatFileSize(file.size);
            uploadContent.style.display = 'none';
            fileInfo.style.display = 'block';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 BYTES';
            const k = 1024;
            const sizes = ['BYTES', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Form submission with progress
        form.addEventListener('submit', (e) => {
            submitBtn.disabled = true;
            submitBtn.textContent = 'ANALYSERAR...';
            progressArea.style.display = 'block';
            
            // Simulate progress
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress >= 90) progress = 90;
                progressFill.style.width = progress + '%';
            }, 200);

            // Clear interval when form actually submits
            setTimeout(() => {
                clearInterval(progressInterval);
                progressFill.style.width = '100%';
            }, 3000);
        });

        // Terminal typing effect for cursor
        const cursor = document.querySelector('.cursor');
        setInterval(() => {
            cursor.style.opacity = cursor.style.opacity === '0' ? '1' : '0';
        }, 500);

        // Add some retro sound effects (optional)
        function playBeep() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'square';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.1);
        }

        // Play beep on button hover (optional)
        submitBtn.addEventListener('mouseenter', () => {
            try {
                // playBeep(); // Uncomment for retro sound effects
            } catch (e) {
                // Ignore audio errors
            }
        });
    </script>
</body>
</html>
